-- 1. Show first name, last name, and gender of patients whose gender is 'M'
SELECT first_name, last_name, gender
FROM patients
WHERE gender = 'M';

-- 2. Show first name and last name of patients who do not have allergies
SELECT first_name, last_name, allergies
FROM patients
WHERE allergies IS NULL;

-- 3. Show first name of patients that start with the letter 'C'
SELECT first_name
FROM patients
WHERE first_name LIKE 'C%';

-- 4. Show first name and last name of patients that weigh within the range of 100 to 120 (inclusive)
SELECT first_name, last_name, weight
FROM patients
WHERE weight BETWEEN 100 AND 120;

-- 5. Update the patients table: If allergies is NULL, replace with 'NKA'
UPDATE patients
SET allergies = 'NKA'
WHERE allergies IS NULL;

SELECT allergies FROM patients;

-- 6. Show first name and last name concatenated into one column as full name
SELECT CONCAT(first_name, ' ', last_name) AS full_name
FROM patients;

-- 7. Show first name, last name, and the full province name of each patient
SELECT p.first_name, p.last_name, pn.province_name
FROM patients p
JOIN province_names pn ON p.province_id = pn.province_id;

-- 8. Show how many patients have a birth_date in 2010
SELECT COUNT(*) AS total_2010_patients
FROM patients
WHERE birth_date LIKE '2010%';

-- 9. Show the patient with the greatest height
SELECT first_name, last_name, height
FROM patients
ORDER BY height DESC
LIMIT 1;

-- 10. Show all columns for patients with specific patient_ids
SELECT *
FROM patients
WHERE patient_id IN (1, 45, 534, 879, 1000);

-- 11. Show the total number of admissions
SELECT COUNT(*) AS total_admissions
FROM admissions;

-- 12. Show all admissions where admitted and discharged on the same day
SELECT *
FROM admissions
WHERE admission_date = discharge_date;

-- 13. Show the total number of admissions for patient_id 579
SELECT COUNT(*) AS admissions_count
FROM admissions
WHERE patient_id = 579;

-- 14. Show unique cities in province_id 'NS'
SELECT DISTINCT(province_id), province_name
FROM province_names
WHERE province_id = 'NS';

-- 15. Show patients with height > 160 and weight > 70
SELECT first_name, last_name, birth_date, height, weight
FROM patients
WHERE height >= 160 AND weight >= 70;

-- 16. Show unique birth years from patients ordered ascending
SELECT DISTINCT YEAR(birth_date) AS birth_year
FROM patients
ORDER BY birth_year ASC;

-- 17. Show unique first names that occur only once
SELECT first_name
FROM patients
GROUP BY first_name
HAVING COUNT(*) = 1;

-- 18. Show patients whose first_name starts and ends with 's' and has at least 6 characters
SELECT patient_id, first_name
FROM patients
WHERE first_name LIKE 's%s'
  AND LENGTH(first_name) >= 6;

-- 19. Show patients whose diagnosis is 'Dementia'
SELECT p.patient_id, p.first_name, p.last_name, a.diagnosis
FROM patients p
JOIN admissions a ON p.patient_id = a.patient_id
WHERE a.diagnosis = 'Dementia';

-- 20. Display every patient's first name ordered by name length and alphabetically
SELECT first_name, LENGTH(first_name) AS name_length
FROM patients
ORDER BY name_length, first_name;

-- 21. Show total male and female patients
SELECT gender, COUNT(*) AS total_count
FROM patients
GROUP BY gender;

-- 23. Show patients admitted multiple times for the same diagnosis
SELECT patient_id, diagnosis, COUNT(*) AS multiple_times
FROM admissions
GROUP BY patient_id, diagnosis
HAVING COUNT(*) > 1;

-- 24. Show city and total number of patients, ordered by most to least patients
SELECT city, COUNT(*) AS total_patients
FROM patients
GROUP BY city
ORDER BY total_patients DESC, city ASC;

-- 25. Show first name, last name, and role (Patient or Doctor)
SELECT first_name, last_name, 'Patient' AS role
FROM patients
UNION
SELECT first_name, last_name, 'Doctor' AS role
FROM doctors;

-- 26. Show all allergies ordered by popularity (excluding NKA)
SELECT allergies, COUNT(*) AS popularity_count
FROM patients
WHERE allergies != 'NKA'
GROUP BY allergies
ORDER BY popularity_count DESC;

-- 27. Show patients born in the 1970s
SELECT first_name, last_name, birth_date
FROM patients
WHERE birth_date LIKE '197%'
ORDER BY birth_date ASC;

-- 28. Display patient's full name: LASTNAME (uppercase), firstname (lowercase)
SELECT CONCAT(UPPER(last_name), ' ', LOWER(first_name)) AS full_name
FROM patients;

SELECT CONCAT(UPPER(last_name), ',', LOWER(first_name)) AS full_name_formatted
FROM patients
ORDER BY first_name DESC;

-- 29. Show province_id and total height where total >= 7000
SELECT province_id, SUM(height) AS total_height
FROM patients
GROUP BY province_id
HAVING total_height >= 7000;

-- 30. Show weight difference for patients with last name 'Maroni'
SELECT MAX(weight) - MIN(weight) AS weight_difference
FROM patients
WHERE last_name = 'Maroni';

-- 31. Show days of month and total admissions, sorted by most to least
SELECT DAY(admission_date) AS day_of_month, COUNT(*) AS total_admissions
FROM admissions
GROUP BY DAY(admission_date)
ORDER BY total_admissions DESC;

-- 32. Group patients by weight range
SELECT
    CASE
        WHEN weight < 50 THEN 'Under 50kg'
        WHEN weight BETWEEN 50 AND 99 THEN '50kg to 99kg'
        WHEN weight >= 100 THEN '100kg and Over'
        ELSE 'Unknown'
    END AS weight_group,
    COUNT(*) AS total_patients
FROM patients
GROUP BY weight_group
ORDER BY weight_group DESC;

-- 33. Show patient_id, weight, height, and isObese (0 or 1)
-- Obese: weight(kg) / (height(m))Â² >= 30
SELECT
    patient_id,
    weight,
    height,
    CASE
        WHEN weight / POWER(height / 100.0, 2) >= 30 THEN 1
        ELSE 0
    END AS isObese
FROM patients;

-- 34. Show patient_id, first_name, last_name, and attending doctor's specialty for diagnosis 'Epilepsy' and doctor 'Lisa'
SELECT p.patient_id, p.first_name, p.last_name, d.specialty
FROM patients p
JOIN admissions a ON p.patient_id = a.patient_id
JOIN doctors d ON a.doctor_id = d.doctor_id
WHERE a.diagnosis = 'Epilepsy' AND d.first_name = 'Lisa';
